# Сборка и запуск

## Сборка платы (ESP32-C3 + датчик освещения)

Требования к комплектующим:

- Плата ESP32-C3 (с USB для прошивки/питания)
- Датчик освещения KY-018 (фоторезисторный модуль)
- Макетная плата (breadboard) или иной способ безопасного монтажа
- Соединительные провода Dupont (3 шт. и более)
- USB-кабель для подключения ESP32-C3 к ПК

Требования к подключению:

- `KY-018 VCC` -> `ESP32-C3 3V3` (не 5V)
- `KY-018 GND` -> `ESP32-C3 GND`
- `KY-018 AO` -> `ESP32-C3 GPIO1` (ADC)
- Используется только аналоговый выход датчика (`AO`)
- Обязательно общий `GND` между датчиком и платой

Рекомендации по качеству сигнала:

- Используйте короткие провода и надежные контакты
- Не прокладывайте сигнальный провод рядом с источниками помех (USB-хабы, блоки питания без экранирования)
- Перед прошивкой проверьте монтаж по схеме в `docs/wiring.md`

## Firmware (ESP32-C3, Arduino `.ino`)

Требования:

- Arduino IDE 2.x
- Установленный пакет плат `esp32` (Espressif Systems)
- Подключённый ESP32-C3 по USB

Шаги:

1. Откройте файл `firmware/firmware_esp32c3.ino` в Arduino IDE.
2. Выберите плату ESP32-C3 в меню **Tools -> Board**.
3. Выберите COM-порт устройства в меню **Tools -> Port**.
4. Установите USB CDC on Boot  в меню **Tools -> Port**.
5. Нажмите **Upload** для прошивки.
6. Откройте **Serial Monitor** и выставьте скорость `115200`.

Ожидаемый вывод монитора: JSON-строки с полями `deviceId`, `sensorId`, `ts`, `value`.

## PC application (.NET)

Требования:

- Windows 10/11
- .NET SDK 10.0+

Подготовка:

1. Откройте `pc-app/appsettings.json`.
2. Укажите корректный `serial.portName` (например, `COM5`).
3. При необходимости настройте диапазон ADC, инверсию, EMA и гистерезис.

Запуск (из папки `pc-app/`):

```powershell
dotnet restore
dotnet run
```

Приложение читает COM-порт, вычисляет целевую яркость и устанавливает её через WMI для встроенного дисплея.

Важно: реализация в `pc-app/` предназначена только для Windows. Для других ОС нужно отдельное приложение, которое поддерживает тот же контракт обмена с устройством (JSON-строки по протоколу из `docs/protocol.md`).

